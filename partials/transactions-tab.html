<!-- Bank Accounts Configuration - Collapsible -->
<div class="transactions-section">
    <div class="section-title-trans" onclick="toggleSection('bankConfigSection')" style="cursor: pointer; user-select: none;">
        <span id="bankConfigToggle">â–¶</span> ğŸ¦ Bank Accounts Config
    </div>
    <div id="bankConfigContent" style="display: none;">
        <!-- Max.co.il Credentials -->
        <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 10px; font-size: 0.95em;">ğŸ’³ Max.co.il (Leumi Card)</h4>
            <div class="alert-trans alert-info-trans" id="maxCredentialsAlert">
                Configure your Max credentials to sync transactions.
            </div>
            <button class="btn btn-primary" onclick="openCredentialsModal('max')">
                ğŸ” Setup Max Credentials
            </button>
        </div>
        
        <!-- Isracard Credentials -->
        <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 10px; font-size: 0.95em;">ğŸ’³ Isracard</h4>
            <div class="alert-trans alert-info-trans" id="isracardCredentialsAlert">
                Configure your Isracard credentials to sync transactions.
            </div>
            <button class="btn btn-primary" onclick="openCredentialsModal('isracard')">
                ğŸ” Setup Isracard Credentials
            </button>
        </div>
        
        <!-- Sync Section -->
        <div>
            <h4 style="margin-bottom: 10px; font-size: 0.95em;">ğŸ”„ Sync Transactions</h4>
            <div class="sync-status">
                <div class="sync-info">
                    <div style="display: flex; flex-direction: column; gap: 5px;">
                        <div>Max: <strong id="lastMaxSyncTime">Never</strong> <span id="lastMaxSyncCount"></span></div>
                        <div>Isracard: <strong id="lastIsracardSyncTime">Never</strong> <span id="lastIsracardSyncCount"></span></div>
                    </div>
                </div>
                <div class="sync-buttons">
                    <button class="btn btn-primary" onclick="syncAllTransactions()" id="syncAllBtn">
                        ğŸ”„ Sync All
                    </button>
                    <button class="btn btn-success" onclick="autoLabelAll()" id="autoLabelBtn">
                        ğŸ·ï¸ Auto-label
                    </button>
                </div>
            </div>
            
            <div class="loading-trans" id="syncLoading">
                <div class="spinner-trans"></div>
                <div>Syncing with banks...</div>
            </div>

            <div id="syncResult"></div>
        </div>
    </div>
</div>

<!-- Filters Section - Collapsible -->
<div class="transactions-section" id="filtersSection">
    <div class="section-title-trans" onclick="toggleSection('filtersSection')" style="cursor: pointer; user-select: none;">
        <span id="filtersToggle">â–¶</span> ğŸ” Filters
    </div>
    <div id="filtersContent" style="display: none;">
        <div style="display: flex; gap: 15px; flex-wrap: wrap; align-items: center;">
            <!-- Unlabeled checkbox -->
            <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
                <input type="checkbox" id="showOnlyUnlabeled" onchange="applyFilters()" style="width: 18px; height: 18px; cursor: pointer;">
                <span>Show only unlabeled</span>
            </label>
            
            <!-- Month filter -->
            <select id="monthFilter" onchange="applyFilters()" style="padding: 8px 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9em; cursor: pointer;">
                <option value="">All months</option>
            </select>
            
            <!-- Category filter -->
            <select id="categoryFilter" onchange="applyFilters()" style="padding: 8px 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9em; cursor: pointer;">
                <option value="">All categories</option>
            </select>
            
            <!-- Search by name -->
            <input 
                type="text" 
                id="searchFilter" 
                placeholder="Search..." 
                oninput="applyFilters()"
                style="padding: 8px 12px; border: 2px solid #dee2e6; border-radius: 8px; font-size: 0.9em; flex: 1; min-width: 150px;"
            />
            
            <button class="btn btn-secondary" onclick="clearFilters()" style="padding: 8px 16px; background: #e9ecef; border: none; border-radius: 8px; cursor: pointer; font-size: 0.9em;">
                Clear
            </button>
        </div>
    </div>
</div>

<!-- All Transactions - Always visible -->
<div class="transactions-section" id="allTransactionsSection">
    <div class="section-title-trans" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
        <span>ğŸ“‹ All Transactions (<span id="transactionCount">0</span>)</span>
        <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 8px; font-weight: 600; white-space: nowrap; font-size: 0.9em;">
            ğŸ’° <span id="transactionTotal">â‚ª0</span>
        </span>
    </div>
    
    <!-- Loading state inside All Transactions -->
    <div id="transactionsLoading" style="display: none; text-align: center; padding: 40px;">
        <div class="spinner-trans"></div>
        <div style="margin-top: 15px; color: #6c757d;">Loading transactions...</div>
    </div>
    
    <!-- Transactions list -->
    <div id="allTransactionsList"></div>
    
    <!-- Empty state -->
    <div class="empty-state-trans" id="emptyState" style="display: none;">
        <div class="empty-state-icon">ğŸ“­</div>
        <div>No transactions yet</div>
        <div style="margin-top: 10px; font-size: 0.9em;">Click "Sync All" to get started</div>
    </div>
</div>

<!-- Credentials Modal (supports both Max and Isracard) -->
<div id="credentialsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="credentialsModalTitle">ğŸ” Bank Credentials</h2>
            <button class="modal-close" onclick="closeCredentialsModal()">âœ•</button>
        </div>
        <div class="modal-body">
            <div class="alert-trans alert-info-trans">
                Your credentials will be encrypted and stored securely in Firebase.
            </div>
            <form id="credentialsForm" onsubmit="saveCredentials(event)">
                <input type="hidden" id="bankType" value="max" />
                
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;" id="usernameLabel">Username</label>
                    <input 
                        type="text" 
                        class="auth-input" 
                        id="bankUsername" 
                        placeholder="Your username"
                        required
                    />
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-weight: 500;" id="passwordLabel">Password</label>
                    <input 
                        type="password" 
                        class="auth-input" 
                        id="bankPassword" 
                        placeholder="Your password"
                        required
                    />
                </div>
                <div id="credentialsError"></div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-button secondary" onclick="closeCredentialsModal()">
                Cancel
            </button>
            <button type="submit" form="credentialsForm" class="modal-button primary" id="saveCredentialsBtn">
                Save Credentials
            </button>
        </div>
    </div>
</div>
