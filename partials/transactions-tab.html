<!-- Sticky Toolbar for Transactions -->
<div class="transactions-sticky-toolbar">
    <button class="toolbar-btn" onclick="toggleFiltersPanel()">
        <span data-translate="filters">Filters</span> <span id="filterToggleIcon">â–¼</span>
    </button>
    <button class="toolbar-btn" onclick="toggleBankConfigFromToolbar()">
        <span data-translate="bankAccountsConfig">Bank Accounts</span>
    </button>
</div>

<!-- Filters Panel (sticky when open) -->
<div class="filters-panel-sticky" id="filtersPanel" style="display: none;">
    <div class="filters-panel-content">
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer;">
            <input type="checkbox" id="showOnlyUnlabeled" onchange="applyFilters()" style="width: 18px; height: 18px; cursor: pointer;">
            <span data-translate="showOnlyUnlabeled">Unlabeled only</span>
        </label>
        
        <select id="monthFilter" onchange="applyFilters()" class="filter-select">
            <option value="" data-translate="allMonths">All months</option>
        </select>
        
        <select id="categoryFilter" onchange="applyFilters()" class="filter-select">
            <option value="" data-translate="allCategories">All categories</option>
        </select>
        
        <input 
            type="text" 
            id="searchFilter" 
            data-translate-placeholder="search"
            placeholder="Search..." 
            oninput="applyFilters()"
            class="filter-search"
        />
        
        <button class="filter-clear-btn" onclick="clearFilters()">
            <span data-translate="clear">Clear</span>
        </button>
    </div>
</div>


<!-- Bank Accounts Configuration - Collapsible -->
<div class="transactions-section">
    <div class="section-title-trans" onclick="toggleSection('bankConfigSection')" style="cursor: pointer; user-select: none;">
        <span id="bankConfigToggle">â–¶</span> <span data-translate="bankAccountsConfig">ğŸ¦ Bank Accounts Config</span>
    </div>
    <div id="bankConfigContent" style="display: none;">
        <!-- Max.co.il Credentials -->
        <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 10px; font-size: 0.95em;">
                <span data-translate="maxLeumi">ğŸ’³ Max.co.il (Leumi Card)</span>
            </h4>
            <div class="alert-trans alert-info-trans" id="maxCredentialsAlert">
                <span data-translate="configureCredentials">Configure your Max credentials to sync transactions.</span>
            </div>
            <button class="btn btn-primary" onclick="openCredentialsModal('max')">
                <span data-translate="setupMaxCredentials">ğŸ” Setup Max Credentials</span>
            </button>
        </div>
        
        <!-- Isracard Credentials -->
        <div style="margin-bottom: 20px;">
            <h4 style="margin-bottom: 10px; font-size: 0.95em;">
                <span data-translate="isracard">ğŸ’³ Isracard</span>
            </h4>
            <div class="alert-trans alert-info-trans" id="isracardCredentialsAlert">
                <span data-translate="configureCredentials">Configure your Isracard credentials to sync transactions.</span>
            </div>
            <button class="btn btn-primary" onclick="openCredentialsModal('isracard')">
                <span data-translate="setupIsracardCredentials">ğŸ” Setup Isracard Credentials</span>
            </button>
        </div>
        
        <!-- Sync Section -->
        <div>
            <h4 style="margin-bottom: 10px; font-size: 0.95em;">
                <span data-translate="syncTransactions">ğŸ”„ Sync Transactions</span>
            </h4>
            <div class="sync-status">
                <div class="sync-info">
                    <div style="display: flex; flex-direction: column; gap: 5px;">
                        <div>Max: <strong id="lastMaxSyncTime" data-translate="never">Never</strong> <span id="lastMaxSyncCount"></span></div>
                        <div>Isracard: <strong id="lastIsracardSyncTime" data-translate="never">Never</strong> <span id="lastIsracardSyncCount"></span></div>
                    </div>
                </div>
                <div class="sync-buttons">
                    <button class="btn btn-primary" onclick="syncAllTransactions()" id="syncAllBtn">
                        <span data-translate="syncAll">ğŸ”„ Sync All</span>
                    </button>
                    <button class="btn btn-success" onclick="autoLabelAll()" id="autoLabelBtn">
                        <span data-translate="autoLabel">ğŸ·ï¸ Auto-label</span>
                    </button>
                </div>
            </div>
            
            <div class="loading-trans" id="syncLoading">
                <div class="spinner-trans"></div>
                <div><span data-translate="syncingWithBanks">Syncing with banks...</span></div>
            </div>

            <div id="syncResult"></div>
        </div>
    </div>
</div>


<!-- All Transactions - Always visible -->
<div class="transactions-section" id="allTransactionsSection">
    <div class="section-title-trans" style="display: flex; justify-content: space-between; align-items: center; flex-wrap: wrap; gap: 10px;">
        <span><span data-translate="allTransactions">ğŸ“‹ All Transactions</span> (<span id="transactionCount">0</span>)</span>
        <span style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 6px 12px; border-radius: 8px; font-weight: 600; white-space: nowrap; font-size: 0.9em;">
            ğŸ’° <span id="transactionTotal">â‚ª0</span>
        </span>
    </div>
    
    <!-- Loading state inside All Transactions -->
    <div id="transactionsLoading" style="display: none; text-align: center; padding: 40px;">
        <div class="spinner-trans"></div>
        <div style="margin-top: 15px; color: #6c757d;">
            <span data-translate="loadingTransactions">Loading transactions...</span>
        </div>
    </div>
    
    <!-- Transactions list -->
    <div id="allTransactionsList"></div>
    
    <!-- Empty state -->
    <div class="empty-state-trans" id="emptyState" style="display: none;">
        <div class="empty-state-icon">ğŸ“­</div>
        <div><span data-translate="noTransactionsYet">No transactions yet</span></div>
        <div style="margin-top: 10px; font-size: 0.9em;">
            <span data-translate="clickSyncToStart">Click "Sync All" to get started</span>
        </div>
    </div>
</div>

<!-- Credentials Modal (supports both Max and Isracard) -->
<div id="credentialsModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h2 id="credentialsModalTitle"><span data-translate="bankCredentials">ğŸ” Bank Credentials</span></h2>
            <button class="modal-close" onclick="closeCredentialsModal()">âœ•</button>
        </div>
        <div class="modal-body">
            <div class="alert-trans alert-info-trans">
                <span data-translate="credentialsSecure">Your credentials will be encrypted and stored securely in Firebase.</span>
            </div>
            <form id="credentialsForm" onsubmit="saveCredentials(event)">
                <input type="hidden" id="bankType" value="max" />
                
                <!-- Max fields (visible par dÃ©faut) -->
                <div id="maxFields">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">
                            <span data-translate="username">Username</span>
                        </label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="maxUsername" 
                            data-translate-placeholder="yourUsername"
                            placeholder="Your username"
                        />
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">
                            <span data-translate="password">Password</span>
                        </label>
                        <input 
                            type="password" 
                            class="auth-input" 
                            id="maxPassword" 
                            data-translate-placeholder="yourPassword"
                            placeholder="Your password"
                        />
                    </div>
                </div>
                
                <!-- Isracard fields (cachÃ©s par dÃ©faut) -->
                <div id="isracardFields" style="display: none;">
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">
                            ID Number
                        </label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="isracardId" 
                            placeholder="Your Israeli ID"
                        />
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">
                            Last 6 Digits of Card
                        </label>
                        <input 
                            type="text" 
                            class="auth-input" 
                            id="isracardCard6" 
                            placeholder="123456"
                            maxlength="6"
                            pattern="[0-9]{6}"
                        />
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-weight: 500;">
                            Password
                        </label>
                        <input 
                            type="password" 
                            class="auth-input" 
                            id="isracardPassword" 
                            placeholder="Your password"
                        />
                    </div>
                </div>
                
                <div id="credentialsError"></div>
            </form>
        </div>
        <div class="modal-footer">
            <button type="button" class="modal-button secondary" onclick="closeCredentialsModal()">
                <span data-translate="cancel">Cancel</span>
            </button>
            <button type="submit" form="credentialsForm" class="modal-button primary" id="saveCredentialsBtn">
                <span data-translate="saveCredentials">Save Credentials</span>
            </button>
        </div>
    </div>
</div>
